`kube-proxy`는 Kubernetes 클러스터의 네트워크 구성 요소 중 하나로, **클러스터 내부의 네트워크 통신을 중재**하고 **서비스 간의 트래픽 라우팅**을 담당합니다. Kubernetes 클러스터 내에서 Pod와 서비스 간의 통신이 원활하게 이루어질 수 있도록 네트워크 규칙을 설정하고 관리하는 중요한 컴포넌트입니다.

kube-proxy는 각 클러스터 노드에서 실행되며, Kubernetes API 서버로부터 서비스 및 엔드포인트 정보를 수신한 후, 해당 정보를 기반으로 네트워크 규칙을 생성합니다.


### kube-proxy의 주요 역할

#### 1. 서비스와 Pod 간의 트래픽 라우팅

- Kubernetes에서 서비스는 여러 Pod를 묶어 단일 엔드포인트로 노출합니다.
- kube-proxy는 서비스와 연결된 Pod 간의 네트워크 트래픽을 적절히 분배하여, 클라이언트 요청이 서비스에 연결된 Pod로 전달되도록 합니다.

#### 2. 가상 IP(Virtual IP) 관리

- Kubernetes 서비스는 **ClusterIP**라는 가상 IP를 통해 클러스터 내부에서 접근할 수 있습니다.
- kube-proxy는 이러한 가상 IP를 실제 Pod IP로 매핑하여 트래픽을 전달합니다.

#### 3. 로드 밸런싱

- kube-proxy는 서비스에 연결된 여러 Pod 간의 트래픽을 분산시켜 로드 밸런싱을 수행합니다. 이를 통해 특정 Pod에 트래픽이 집중되는 것을 방지하고, 클러스터의 성능을 최적화합니다.


### kube-proxy의 주요 기능

#### 1. 네트워크 규칙 생성

- kube-proxy는 iptables, IPVS, 또는 유저스페이스(user space)를 사용하여 네트워크 규칙을 생성하고 관리합니다.
- 이러한 규칙은 클러스터 내부에서 서비스와 Pod 간의 통신을 가능하게 합니다.

#### 2. 엔드포인트 업데이트

- kube-proxy는 Kubernetes API 서버로부터 서비스와 관련된 엔드포인트 정보를 지속적으로 수신합니다.
- 엔드포인트 정보가 변경되면(예: 새로운 Pod 추가, Pod 종료 등), 네트워크 규칙을 즉시 업데이트하여 트래픽이 올바른 Pod로 전달되도록 보장합니다.

#### 3. 프로토콜 지원

- kube-proxy는 TCP, UDP, SCTP와 같은 다양한 네트워크 프로토콜을 지원합니다.
- 이를 통해 다양한 유형의 애플리케이션 트래픽을 처리할 수 있습니다.


### kube-proxy의 동작 모드

kube-proxy는 네트워크 트래픽을 처리하기 위해 세 가지 주요 동작 모드를 제공합니다:

#### 1. User Space 모드 (Deprecated)

- 가장 초기 버전의 kube-proxy 동작 방식.
- 클라이언트 요청은 kube-proxy 프로세스로 전달되고, kube-proxy는 적절한 Pod로 요청을 전달합니다.
- 성능이 낮고, 대규모 클러스터에는 적합하지 않아 현재는 거의 사용되지 않습니다.

#### 2. iptables 모드

- iptables를 사용하여 네트워크 규칙을 설정합니다.
- 클라이언트 요청은 iptables 규칙에 따라 적절한 Pod로 직접 전달됩니다.
- User Space 모드에 비해 성능이 훨씬 뛰어나며, 대부분의 Kubernetes 클러스터에서 기본적으로 사용됩니다.

#### 3. IPVS 모드

- IPVS(Linux Virtual Server)를 사용하여 네트워크 규칙을 설정합니다.
- iptables 모드보다 더 높은 성능과 확장성을 제공합니다.
- 대규모 클러스터에서 적합하며, 로드 밸런싱 알고리즘을 더 다양하게 지원합니다(예: 라운드 로빈, 최소 연결 등).

### kube-proxy의 한계

- **L7 로드 밸런싱 미지원**:
    - kube-proxy는 L4(전송 계층) 수준에서만 로드 밸런싱을 수행하며, HTTP/HTTPS와 같은 L7(애플리케이션 계층) 로드 밸런싱은 지원하지 않습니다.
    - L7 로드 밸런싱이 필요한 경우, Ingress Controller와 같은 추가적인 컴포넌트를 사용해야 합니다.

- **확장성 문제**:
    - iptables 모드는 대규모 클러스터에서 네트워크 규칙이 많아질수록 성능 저하가 발생할 수 있습니다.
    - 이러한 한계를 극복하기 위해 IPVS 모드를 사용하는 것이 권장됩니다.

