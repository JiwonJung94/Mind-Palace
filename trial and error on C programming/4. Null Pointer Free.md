

Code review를 받던 중, 이런 메세지를 받은 적이 있습니다.

"Is this pointer not Null???"

코드는 대략 이런 식이었습니다.

int * test= malloc(int*) ;

if(test != NULL)
{

	....

}
free(test);


맨 아래 free(test) 부분을 지적 받았습니다.
무엇이 문제였을까요??


만약 test가 malloc으로 할당이 되지 않아 NULL이라면 
NULL Pointer를 free하는 셈입니다.
그래서 코드를 수정한다면

int * test= malloc(int*) ;

if(test != NULL)
{
  ...
  free(test);
}

이렇게 한다면 동적할당이 제대로 되지 않았을 때 해당 포인터를 free하지 않습니다.

그렇다면 여기서 궁금한 점이 생겼습니다.
왜 NULL Pointer를 free하면 안 될까요?
NULL Pointer를 free할 경우 무슨 일이 생길까요?

메모리를 잘못 접근하기 때문에 프로그램이 갑자기 종료할 수 있습니다.
gcc 컴파일러가 뛰어난 환경에서는 괜찮을 수 있겠지만
임베디드 등 메모리 관리에 민감한 분야에서는 Memory abort로 프로그램이 종료가 될 수 있습니다.

코드 수정 후에 경험이 많은 엔지니어 분께서 이렇게 답해주셨습니다.
"우리가 작업하는 환경에서는 메모리 관리가 정말 중요하다
실제로 영향이 없다고 하더라도, 미리미리 메모리 관리에 신경을 쓰는 것이 좋다.
에러는 언제 어떻게 생길지 모르기 때문에 
정상적으로 동작하는 게 확실한 코드를 짜는 것이 좋다."