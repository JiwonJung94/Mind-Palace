## 타입 제약 조건이란?

타입 제약 조건은 특정 타입을 구성하는 값을 정의하는 규칙입니다. 타입 제약 조건은 데이터의 범위를 제한하여, 데이터베이스에서 허용되는 값을 명확히 정의합니다. 이는 데이터 무결성을 유지하고, 데이터베이스가 비즈니스 로직에 맞게 동작하도록 보장합니다. 시스템이 정의한 타입의 경우, 시스템 자체가 이러한 규칙을 관리합니다. 그러나 사용자가 정의한 타입에서는 사용자가 직접 이러한 제약 조건을 설정할 수 있습니다.

## 사용자 정의 타입의 예

사용자 정의 타입은 특정 비즈니스 로직에 맞춰 데이터의 범위를 제한할 수 있습니다. 예를 들어, 배송 수량을 나타내는 타입을 정의한다고 가정해 봅시다. 이때, 수량은 단순히 정수(INTEGER) 타입이 아닌, 사용자 정의 타입(QTY)으로 정의할 수 있습니다. 이를 통해 수량의 범위를 특정 값으로 제한할 수 있습니다.

### QTY 타입 정의

```tutorial_d
TYPE QTY POSSREP { Q INTEGER CONSTRAINT Q ≥ 0 AND Q ≤ 5000 }
```

- **타입 정의**: `QTY`라는 이름의 타입을 정의합니다.
- **가능한 표현(POSSREP)**: `Q`라는 정수형 컴포넌트를 가진 `QTY`의 가능한 표현을 정의합니다.
- **제약 조건**: `Q`는 0에서 5000 사이의 값이어야 합니다. 이는 `QTY` 타입의 유효한 값을 정의하는 제약 조건을 형성합니다.

## 사용자 정의 타입과 제약 조건

사용자 정의 타입을 정의할 때, 명시적인 제약 조건을 설정하지 않더라도 기본적인 제약 조건이 존재합니다. 예를 들어, `QTY`라는 타입을 정의할 때 명시적인 제약 조건이 없더라도, 이는 암묵적으로 모든 정수 값을 허용하는 약한 제약 조건을 가지게 됩니다. 이는 `QTY` 타입의 가능한 표현이 기본적으로 모든 정수를 포함하기 때문입니다.

```plaintext
TYPE QTY POSSREP { Q INTEGER CONSTRAINT TRUE }
```

위의 정의에서 볼 수 있듯이, `CONSTRAINT TRUE`는 모든 정수를 허용하는 기본 제약 조건을 의미합니다. 따라서 명시적인 제약 조건을 추가하지 않으면, 타입은 기본적으로 모든 가능한 값을 허용합니다.

## 다양한 가능한 표현

데이터베이스 언어에서는 하나의 타입에 여러 가능한 표현을 정의할 수 있습니다. 이는 동일한 데이터를 다양한 방식으로 표현할 수 있게 하여, 데이터의 유연성을 높입니다. 예를 들어, 2차원 공간에서 점을 나타내는 타입은 카르테시안 좌표나 극좌표 등 여러 표현을 가질 수 있습니다.

### POINT 타입 정의

```plaintext
TYPE POINT POSSREP { X RATIONAL, Y RATIONAL CONSTRAINT SQRT(X**2 + Y**2) ≤ 100.0 }
```

- **타입 정의**: `POINT`라는 이름의 타입을 정의합니다.
- **가능한 표현**: `X`와 `Y`라는 두 개의 RATIONAL 컴포넌트를 가진 카르테시안 표현을 정의합니다.
- **제약 조건**: 원점에서 반지름 100인 원 내부에 있는 점만 유효합니다.

이와 같이, 사용자 정의 타입과 타입 제약 조건은 데이터베이스의 무결성을 강화하고, 데이터가 비즈니스 요구 사항을 충족하도록 보장하는 데 중요한 역할을 합니다.

## 타입 제약 조건의 검증 시점

타입 제약 조건은 선택자가 호출될 때마다 검증됩니다. 예를 들어, `QTY` 타입의 값이 0에서 5000 사이의 정수여야 한다고 가정할 때, `QTY(250)`이라는 표현은 선택자의 호출로 성공하지만, `QTY(6000)`은 실패합니다. 이는 타입 제약 조건을 위반하기 때문입니다. 따라서 변수나 릴레이션 변수(relvar)는 항상 올바른 타입의 값을 가져야 하며, 그렇지 않으면 모순이 발생합니다.

## SQL에서의 타입 제약 조건

SQL에서는 사용자 정의 타입에 대한 제약 조건을 직접 지원하지 않습니다. 즉, SQL에서는 기본적인 정수 범위를 지정할 수 있지만, 특정 범위 내에 있어야 한다는 추가적인 제약 조건을 직접 설정할 수 없습니다. 예를 들어, SQL에서 `QTY` 타입을 정의할 때, 모든 정수를 허용하게 됩니다.

```sql
CREATE TYPE QTY AS INTEGER FINAL;
```

이 정의는 모든 정수를 유효한 값으로 간주합니다. 특정 범위로 제한하려면, 각 테이블에 대해 별도의 데이터베이스 제약 조건을 설정해야 합니다.

```sql
CREATE TABLE SP (
    SNO VARCHAR(5) NOT NULL,
    PNO VARCHAR(6) NOT NULL,
    QTY QTY NOT NULL,
    UNIQUE (SNO, PNO),
    FOREIGN KEY (SNO) REFERENCES S(SNO),
    FOREIGN KEY (PNO) REFERENCES P(PNO),
    CONSTRAINT SPQC CHECK (QTY >= 0 AND QTY <= 5000)
);
```

위의 예제에서 `CHECK` 제약 조건은 `QTY` 값이 0에서 5000 사이에 있어야 한다는 것을 명시합니다.