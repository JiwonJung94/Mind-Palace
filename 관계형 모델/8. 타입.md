타입이라는 개념은 프로그래밍 언어와 데이터베이스 시스템에서 중요한 역할을 합니다. 타입은 특정 종류의 모든 가능한 값의 유한한 집합에 이름을 붙인 것으로, 이로 인해 데이터의 유효성을 보장하고 오류를 방지할 수 있습니다. 이 글에서는 타입의 본질과 그 활용에 대해 체계적으로 설명하겠습니다.

## 타입의 본질

타입은 특정 종류의 값들을 묶어주는 개념입니다. 예를 들어, 정수, 문자열, XML 문서, 특정 헤딩을 가진 관계 등이 있습니다. 타입은 다음과 같은 특징을 가집니다:

1. **유한성**: 우리가 다루는 타입은 항상 유한한 집합입니다. 이는 컴퓨터가 유한한 자원을 가지고 있기 때문입니다.
2. **고유성**: 타입은 이름을 가집니다. 서로 다른 이름을 가진 타입은 서로 다른 타입으로 간주됩니다.
3. **소속성**: 모든 값은 정확히 하나의 타입에 속합니다. 타입 상속이 없는 한, 값은 두 개 이상의 타입에 속하지 않습니다.

## 타입과 연산자

각 타입은 그 타입의 값들을 조작하기 위한 연산자 집합을 가집니다. 연산자는 해당 타입의 값이나 변수를 입력으로 받아 결과를 반환합니다. 예를 들어:

- 정수 타입은 산술 연산자(+, -, *, /)를 가집니다.
- 문자열 타입은 문자열 연결 연산자(||)나 부분 문자열 추출 연산자(SUBSTR)를 가질 수 있습니다.
- XML 문서는 XPath와 XQuery 같은 특수 연산자를 가집니다.

모든 타입은 할당 연산자(":=")와 등호 비교 연산자("=")를 기본적으로 가집니다.

## 사용자 정의 타입

사용자 정의 타입을 만들 때는 다음 사항을 고려해야 합니다:

1. **이름 정의**: 타입의 이름을 정합니다.
2. **값 정의**: 해당 타입을 구성하는 값을 정의합니다.
3. **물리적 표현 정의**: 값의 물리적 표현을 정의합니다. 이는 구현과 관련된 문제입니다.
4. **선택자 연산자 정의**: 값을 선택하거나 지정하기 위한 연산자를 정의합니다.
5. **연산자 정의**: 할당, 비교, 기타 필요한 연산자를 정의합니다.
6. **결과 타입 정의**: 연산자의 결과로 반환될 값의 타입을 정의합니다.

## 예시: 사용자 정의 타입 POINT

2차원 공간의 점을 나타내는 사용자 정의 타입 POINT를 예로 들어보겠습니다. POINT 타입은 X, Y 좌표를 가지며, 이를 통해 다양한 연산을 수행할 수 있습니다. 예를 들어, REFLECT 연산자는 주어진 점을 기준으로 반사된 점을 반환합니다.

```plaintext
OPERATOR REFLECT ( P POINT ) RETURNS POINT ;
RETURN POINT ( - THE_X ( P ) , - THE_Y ( P ) ) ;
END OPERATOR ;
```

위의 예시에서 POINT 타입의 단일 매개변수를 받아, X와 Y 좌표를 반전시켜 새로운 POINT를 반환합니다.

## 시스템 정의 타입과 사용자 정의 타입

시스템 정의 타입은 시스템에 의해 미리 정의된 타입으로, INTEGER, STRING 등이 이에 해당합니다. 이러한 타입들은 기본 연산자를 시스템이 제공하며, 사용자는 추가 연산자를 정의할 수 있습니다. 반면 사용자 정의 타입은 개발자가 필요에 따라 정의할 수 있으며, 이는 시스템의 확장성을 높입니다.


## 스칼라 타입 vs. 비스칼라 타입

프로그래밍과 데이터베이스 설계에서, 타입은 흔히 스칼라(scalar)와 비스칼라(nonscalar)로 구분됩니다. 간단히 말해서, 스칼라 타입은 사용자에게 보이는 구성 요소가 없는 타입을 의미하며, 비스칼라 타입은 그렇지 않은 타입을 의미합니다. 이러한 구분은 데이터베이스 모델링과 프로그래밍에서 직관적으로 유용할 수 있지만, 공식적인 정의는 아닙니다. 이 글에서는 스칼라와 비스칼라 타입의 개념을 자세히 살펴보겠습니다.

### 스칼라 타입

스칼라 타입은 사용자에게 보이는 내부 구성 요소가 없는 타입입니다. 예를 들어, INTEGER 타입은 스칼라 타입입니다. INTEGER 타입의 값이나 변수는 더 이상 분해할 수 없는 원자적(atomic) 단위로 간주됩니다. 이러한 특성 덕분에 스칼라 타입은 주로 기본 데이터 타입으로 사용되며, 복잡한 구조를 가지지 않습니다.

### 비스칼라 타입

비스칼라 타입은 사용자에게 보이는 구성 요소가 있는 타입입니다. 튜플(tuple)과 릴레이션(relation) 타입이 대표적인 비스칼라 타입입니다. 이 타입들은 여러 속성(attributes)을 가지며, 각 속성은 이름과 타입의 쌍으로 정의됩니다. 이러한 특성 때문에 비스칼라 타입은 복잡한 데이터 구조를 표현하는 데 유용합니다. 예를 들어, 데이터베이스의 테이블은 릴레이션 타입으로 모델링되며, 각 행(row)은 튜플로 표현됩니다.

### 타입 생성기

비스칼라 타입은 종종 타입 생성기(type generator)를 통해 생성됩니다. 타입 생성기는 특정 타입을 반환하는 특별한 연산자(operator)로, 컴파일 시간에 호출됩니다. 예를 들어, RELATION과 TUPLE은 각각 릴레이션 타입과 튜플 타입을 생성하는 타입 생성기입니다. 이러한 타입 생성기를 사용하면 다양한 데이터 구조를 정의할 수 있습니다.


SQL에서 타입 검사와 타입 변환(coercion)은 데이터 무결성을 유지하고 예기치 않은 오류를 방지하기 위해 중요한 역할을 합니다. SQL은 약간의 강한 타입 시스템을 지원하여, 데이터 타입 간의 불일치로 인한 오류를 최소화하려고 합니다. 이 글에서는 SQL에서의 타입 검사와 변환의 개념을 설명하고, 이러한 변환이 어떻게 예상치 못한 결과를 초래할 수 있는지를 살펴보겠습니다.


## 타입 검사와 타입 변환
### 타입 검사

SQL에서 타입 검사는 데이터가 특정한 타입의 변수에 할당되거나 비교될 때 발생합니다. SQL은 다음과 같은 타입 검사 규칙을 따릅니다:

- **BOOLEAN 타입**: BOOLEAN 값은 오직 BOOLEAN 타입의 변수에만 할당될 수 있으며, 다른 BOOLEAN 값과만 비교할 수 있습니다.
- **숫자 타입**: 숫자(INTEGER, SMALLINT, BIGINT, NUMERIC, DECIMAL, FLOAT) 값은 숫자 타입의 변수에만 할당될 수 있으며, 다른 숫자 값과만 비교할 수 있습니다.
- **문자 문자열 타입**: 문자 문자열(CHAR, VARCHAR, CLOB) 값은 문자 문자열 타입의 변수에만 할당될 수 있으며, 다른 문자 문자열 값과만 비교할 수 있습니다.
- **비트 문자열 타입**: 비트 문자열(BINARY, VARBINARY, BLOB) 값은 비트 문자열 타입의 변수에만 할당될 수 있으며, 다른 비트 문자열 값과만 비교할 수 있습니다.

이러한 규칙 덕분에, 서로 다른 타입 간의 불법적인 비교나 할당을 방지할 수 있습니다. 예를 들어, 숫자와 문자 문자열을 비교하려는 시도는 불법입니다.

### 타입 변환(Coercion)

타입 변환은 서로 다른 타입의 데이터를 비교하거나 결합할 때 발생할 수 있습니다. SQL에서는 숫자 타입 간의 비교에서 타입 변환이 자동으로 이루어질 수 있습니다. 예를 들어, INTEGER와 FLOAT를 비교할 때 INTEGER 값은 FLOAT 타입으로 변환되어 비교됩니다.

그러나 이러한 자동 변환은 예상치 못한 결과를 초래할 수 있습니다. 예를 들어, 두 테이블 간의 UNION 연산을 수행할 때, 각 테이블의 열 타입이 다르다면 SQL은 자동으로 타입을 변환하여 결과를 생성합니다. 이로 인해, 두 테이블 중 어느 쪽에도 나타나지 않는 행이 결과에 포함될 수 있습니다. 이는 데이터의 정확성과 무결성에 문제를 일으킬 수 있습니다.

#### 타입 변환 피하기

타입 변환으로 인한 오류를 피하기 위해, 다음과 같은 권장 사항을 따르는 것이 좋습니다:

1. **일관된 데이터 타입 사용**: 동일한 이름을 가진 열은 항상 동일한 타입을 가지도록 설계합니다. 이는 데이터베이스의 스키마를 설계할 때 중요한 고려 사항입니다.
   
2. **명시적 변환 사용**: 타입 변환이 불가피한 경우, `CAST`나 `CONVERT`와 같은 명시적 변환 함수를 사용하여 변환합니다. 이는 코드의 가독성을 높이고, 의도하지 않은 자동 변환을 방지할 수 있습니다.

   ```sql
   SELECT CAST(X AS NUMERIC(5,1)) AS X, Y FROM T1
   UNION
   SELECT X, CAST(Y AS NUMERIC(5,1)) AS Y FROM T2
   ```

#### 내장된 타입 변환

SQL에서는 몇 가지 타입 변환이 기본적으로 내장되어 있습니다:

- **행 서브쿼리**: 테이블 표현식이 행 서브쿼리로 사용될 때, 해당 테이블은 단일 행으로 변환됩니다.
- **스칼라 서브쿼리**: 테이블 표현식이 스칼라 서브쿼리로 사용될 때, 해당 테이블은 단일 값으로 변환됩니다.
- **ALL 또는 ANY 비교**: 비교에서 스칼라 표현식이 행으로 변환될 수 있습니다.

이러한 내장된 변환은 SQL의 기본 구조와 집계 기능에서 자주 사용됩니다.
